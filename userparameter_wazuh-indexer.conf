### WAZUH INDEXER — UserParameters ###
# Host: este arquivo é para o NÓ do Indexer
# Teste local: zabbix_agent2 -t <chave>

# --- Serviço systemd ---
UserParameter=wazuh.indexer.service,systemctl is-active wazuh-indexer.service

# --- Saúde do cluster (JSON bruto e status de cor) ---
UserParameter=wazuh.indexer.cluster.health.raw,curl -s -k -u admin:admin https://127.0.0.1:9200/_cluster/health | jq -c .
UserParameter=wazuh.indexer.cluster.status,curl -s -k -u admin:admin https://127.0.0.1:9200/_cluster/health | jq -r .status
UserParameter=wazuh.indexer.cluster.unassigned_shards,curl -s -k -u admin:admin https://127.0.0.1:9200/_cluster/health | jq -r .unassigned_shards
UserParameter=wazuh.indexer.cluster.active_primary_shards,curl -s -k -u admin:admin https://127.0.0.1:9200/_cluster/health | jq -r .active_primary_shards

# --- Node (este nó do indexer) — métricas rápidas via _cat/nodes ---
UserParameter=wazuh.indexer.node.name,curl -s -k -u admin:admin 'https://127.0.0.1:9200/_cat/nodes?h=name' | head -n1 | tr -d ' '
UserParameter=wazuh.indexer.node.heap_percent,curl -s -k -u admin:admin 'https://127.0.0.1:9200/_cat/nodes?h=heap.percent' | head -n1 | tr -d ' '
UserParameter=wazuh.indexer.node.cpu_percent,curl -s -k -u admin:admin 'https://127.0.0.1:9200/_cat/nodes?h=cpu' | head -n1 | tr -d ' '

# --- FS (espaço em disco) via _nodes/stats/fs — bytes disponíveis e totais ---
UserParameter=wazuh.indexer.fs.available_bytes,curl -s -k -u admin:admin 'https://127.0.0.1:9200/_nodes/stats/fs' | jq -r '.nodes | to_entries[0].value.fs.total.available_in_bytes'
UserParameter=wazuh.indexer.fs.total_bytes,curl -s -k -u admin:admin 'https://127.0.0.1:9200/_nodes/stats/fs' | jq -r '.nodes | to_entries[0].value.fs.total.total_in_bytes'

# --- Healthcheck HTTP simples (código 200 esperado) ---
UserParameter=wazuh.indexer.http_code,curl -s -o /dev/null -w "%{http_code}" -k -u admin:admin https://127.0.0.1:9200/
